--- net/minecraft/world/entity/animal/Fox.java
+++ net/minecraft/world/entity/animal/Fox.java
@@ -13,10 +13,12 @@
 import java.util.function.Predicate;
 import java.util.stream.Collectors;
 import javax.annotation.Nullable;
 import net.minecraft.advancements.CriteriaTriggers;
 import net.minecraft.core.BlockPos;
+import net.minecraft.core.particles.ItemParticleOption;
+import net.minecraft.core.particles.ParticleTypes;
 import net.minecraft.nbt.CompoundTag;
 import net.minecraft.nbt.ListTag;
 import net.minecraft.nbt.NbtUtils;
 import net.minecraft.network.syncher.EntityDataAccessor;
 import net.minecraft.network.syncher.EntityDataSerializers;
@@ -26,14 +28,17 @@
 import net.minecraft.server.level.ServerPlayer;
 import net.minecraft.sounds.SoundEvent;
 import net.minecraft.sounds.SoundEvents;
 import net.minecraft.stats.Stats;
 import net.minecraft.tags.FluidTags;
+import net.minecraft.tags.ItemTags;
+import net.minecraft.tags.Tag;
 import net.minecraft.util.Mth;
 import net.minecraft.world.DifficultyInstance;
+import net.minecraft.world.InteractionHand;
 import net.minecraft.world.damagesource.DamageSource;
-import net.minecraft.world.entity.AgableMob;
+import net.minecraft.world.entity.AgeableMob;
 import net.minecraft.world.entity.Entity;
 import net.minecraft.world.entity.EntityDimensions;
 import net.minecraft.world.entity.EntitySelector;
 import net.minecraft.world.entity.EntityType;
 import net.minecraft.world.entity.EquipmentSlot;
@@ -76,31 +81,40 @@
 import net.minecraft.world.level.ServerLevelAccessor;
 import net.minecraft.world.level.biome.Biome;
 import net.minecraft.world.level.biome.Biomes;
 import net.minecraft.world.level.block.Block;
 import net.minecraft.world.level.block.Blocks;
+import net.minecraft.world.level.block.CaveVines;
 import net.minecraft.world.level.block.SweetBerryBushBlock;
 import net.minecraft.world.level.block.state.BlockState;
 import net.minecraft.world.level.pathfinder.BlockPathTypes;
 import net.minecraft.world.phys.Vec3;
 
 public class Fox extends Animal {
    private static final EntityDataAccessor<Integer> DATA_TYPE_ID;
    private static final EntityDataAccessor<Byte> DATA_FLAGS_ID;
+   private static final int FLAG_SITTING = 1;
+   public static final int FLAG_CROUCHING = 4;
+   public static final int FLAG_INTERESTED = 8;
+   public static final int FLAG_POUNCING = 16;
+   private static final int FLAG_SLEEPING = 32;
+   private static final int FLAG_FACEPLANTED = 64;
+   private static final int FLAG_DEFENDING = 128;
    private static final EntityDataAccessor<Optional<UUID>> DATA_TRUSTED_ID_0;
    private static final EntityDataAccessor<Optional<UUID>> DATA_TRUSTED_ID_1;
-   private static final Predicate<ItemEntity> ALLOWED_ITEMS;
+   static final Predicate<ItemEntity> ALLOWED_ITEMS;
    private static final Predicate<Entity> TRUSTED_TARGET_SELECTOR;
-   private static final Predicate<Entity> STALKABLE_PREY;
+   static final Predicate<Entity> STALKABLE_PREY;
    private static final Predicate<Entity> AVOID_PLAYERS;
+   private static final int MIN_TICKS_BEFORE_EAT = 600;
    private Goal landTargetGoal;
    private Goal turtleEggTargetGoal;
    private Goal fishTargetGoal;
    private float interestedAngle;
    private float interestedAngleO;
-   private float crouchAmount;
-   private float crouchAmountO;
+   float crouchAmount;
+   float crouchAmountO;
    private int ticksSinceEaten;
 
    public Fox(EntityType<? extends Fox> var1, Level var2) {
       super(var1, var2);
       this.lookControl = new Fox.FoxLookControl();
@@ -144,11 +158,11 @@
       this.goalSelector.addGoal(6, new Fox.SeekShelterGoal(1.25D));
       this.goalSelector.addGoal(7, new Fox.FoxMeleeAttackGoal(1.2000000476837158D, true));
       this.goalSelector.addGoal(7, new Fox.SleepGoal());
       this.goalSelector.addGoal(8, new Fox.FoxFollowParentGoal(this, 1.25D));
       this.goalSelector.addGoal(9, new Fox.FoxStrollThroughVillageGoal(32, 200));
-      this.goalSelector.addGoal(10, new Fox.FoxEatBerriesGoal(1.2000000476837158D, 12, 2));
+      this.goalSelector.addGoal(10, new Fox.FoxEatBerriesGoal(1.2000000476837158D, 12, 1));
       this.goalSelector.addGoal(10, new LeapAtTargetGoal(this, 0.4F));
       this.goalSelector.addGoal(11, new WaterAvoidingRandomStrollGoal(this, 1.0D));
       this.goalSelector.addGoal(11, new Fox.FoxSearchForItemsGoal());
       this.goalSelector.addGoal(12, new Fox.FoxLookAtPlayerGoal(this, Player.class, 24.0F));
       this.goalSelector.addGoal(13, new Fox.PerchAndSearchGoal());
@@ -228,15 +242,30 @@
          this.setItemSlot(EquipmentSlot.MAINHAND, var3);
       }
 
    }
 
+   public void handleEntityEvent(byte var1) {
+      if (var1 == 45) {
+         ItemStack var2 = this.getItemBySlot(EquipmentSlot.MAINHAND);
+         if (!var2.isEmpty()) {
+            for(int var3 = 0; var3 < 8; ++var3) {
+               Vec3 var4 = (new Vec3(((double)this.random.nextFloat() - 0.5D) * 0.1D, Math.random() * 0.1D + 0.1D, 0.0D)).xRot(-this.getXRot() * 0.017453292F).yRot(-this.getYRot() * 0.017453292F);
+               this.level.addParticle(new ItemParticleOption(ParticleTypes.ITEM, var2), this.getX() + this.getLookAngle().x / 2.0D, this.getY(), this.getZ() + this.getLookAngle().z / 2.0D, var4.x, var4.y + 0.05D, var4.z);
+            }
+         }
+      } else {
+         super.handleEntityEvent(var1);
+      }
+
+   }
+
    public static AttributeSupplier.Builder createAttributes() {
       return Mob.createMobAttributes().add(Attributes.MOVEMENT_SPEED, 0.30000001192092896D).add(Attributes.MAX_HEALTH, 10.0D).add(Attributes.FOLLOW_RANGE, 32.0D).add(Attributes.ATTACK_DAMAGE, 2.0D);
    }
 
-   public Fox getBreedOffspring(ServerLevel var1, AgableMob var2) {
+   public Fox getBreedOffspring(ServerLevel var1, AgeableMob var2) {
       Fox var3 = (Fox)EntityType.FOX.create(var1);
       var3.setFoxType(this.random.nextBoolean() ? this.getFoxType() : ((Fox)var2).getFoxType());
       return var3;
    }
 
@@ -278,16 +307,16 @@
          this.targetSelector.addGoal(6, this.turtleEggTargetGoal);
       }
 
    }
 
-   protected void usePlayerItem(Player var1, ItemStack var2) {
-      if (this.isFood(var2)) {
-         this.playSound(this.getEatingSound(var2), 1.0F, 1.0F);
+   protected void usePlayerItem(Player var1, InteractionHand var2, ItemStack var3) {
+      if (this.isFood(var3)) {
+         this.playSound(this.getEatingSound(var3), 1.0F, 1.0F);
       }
 
-      super.usePlayerItem(var1, var2);
+      super.usePlayerItem(var1, var2, var3);
    }
 
    protected float getStandingEyeHeight(Pose var1, EntityDimensions var2) {
       return this.isBaby() ? var2.height * 0.85F : 0.4F;
    }
@@ -298,18 +327,18 @@
 
    private void setFoxType(Fox.Type var1) {
       this.entityData.set(DATA_TYPE_ID, var1.getId());
    }
 
-   private List<UUID> getTrustedUUIDs() {
+   List<UUID> getTrustedUUIDs() {
       ArrayList var1 = Lists.newArrayList();
-      var1.add(((Optional)this.entityData.get(DATA_TRUSTED_ID_0)).orElse((Object)null));
-      var1.add(((Optional)this.entityData.get(DATA_TRUSTED_ID_1)).orElse((Object)null));
+      var1.add((UUID)((Optional)this.entityData.get(DATA_TRUSTED_ID_0)).orElse((Object)null));
+      var1.add((UUID)((Optional)this.entityData.get(DATA_TRUSTED_ID_1)).orElse((Object)null));
       return var1;
    }
 
-   private void addTrustedUUID(@Nullable UUID var1) {
+   void addTrustedUUID(@Nullable UUID var1) {
       if (((Optional)this.entityData.get(DATA_TRUSTED_ID_0)).isPresent()) {
          this.entityData.set(DATA_TRUSTED_ID_1, Optional.ofNullable(var1));
       } else {
          this.entityData.set(DATA_TRUSTED_ID_0, Optional.ofNullable(var1));
       }
@@ -364,27 +393,27 @@
 
    public boolean isFaceplanted() {
       return this.getFlag(64);
    }
 
-   private void setFaceplanted(boolean var1) {
+   void setFaceplanted(boolean var1) {
       this.setFlag(64, var1);
    }
 
-   private boolean isDefending() {
+   boolean isDefending() {
       return this.getFlag(128);
    }
 
-   private void setDefending(boolean var1) {
+   void setDefending(boolean var1) {
       this.setFlag(128, var1);
    }
 
    public boolean isSleeping() {
       return this.getFlag(32);
    }
 
-   private void setSleeping(boolean var1) {
+   void setSleeping(boolean var1) {
       this.setFlag(32, var1);
    }
 
    private void setFlag(int var1, boolean var2) {
       if (var2) {
@@ -440,11 +469,11 @@
          this.spitOutItem(this.getItemBySlot(EquipmentSlot.MAINHAND));
          this.onItemPickup(var1);
          this.setItemSlot(EquipmentSlot.MAINHAND, var2.split(1));
          this.handDropChances[EquipmentSlot.MAINHAND.getIndex()] = 2.0F;
          this.take(var1, var2.getCount());
-         var1.remove();
+         var1.discard();
          this.ticksSinceEaten = 0;
       }
 
    }
 
@@ -485,11 +514,11 @@
       }
 
    }
 
    public boolean isFood(ItemStack var1) {
-      return var1.getItem() == Items.SWEET_BERRIES;
+      return var1.is((Tag)ItemTags.FOX_FOOD);
    }
 
    protected void onOffspringSpawnedFromEgg(Player var1, Mob var2) {
       ((Fox)var2).addTrustedUUID(var1.getUUID());
    }
@@ -500,10 +529,14 @@
 
    public void setIsPouncing(boolean var1) {
       this.setFlag(16, var1);
    }
 
+   public boolean isJumping() {
+      return this.jumping;
+   }
+
    public boolean isFullyCrouched() {
       return this.crouchAmount == 3.0F;
    }
 
    public void setIsCrouching(boolean var1) {
@@ -520,10 +553,18 @@
 
    public boolean isInterested() {
       return this.getFlag(8);
    }
 
+   public float getHeadRollAngle(float var1) {
+      return Mth.lerp(var1, this.interestedAngleO, this.interestedAngle) * 0.11F * 3.1415927F;
+   }
+
+   public float getCrouchAmount(float var1) {
+      return Mth.lerp(var1, this.crouchAmountO, this.crouchAmount);
+   }
+
    public void setTarget(@Nullable LivingEntity var1) {
       if (this.isDefending() && var1 == null) {
          this.setDefending(false);
       }
 
@@ -532,24 +573,24 @@
 
    protected int calculateFallDamage(float var1, float var2) {
       return Mth.ceil((var1 - 5.0F) * var2);
    }
 
-   private void wakeUp() {
+   void wakeUp() {
       this.setSleeping(false);
    }
 
-   private void clearStates() {
+   void clearStates() {
       this.setIsInterested(false);
       this.setIsCrouching(false);
       this.setSitting(false);
       this.setSleeping(false);
       this.setDefending(false);
       this.setFaceplanted(false);
    }
 
-   private boolean canMove() {
+   boolean canMove() {
       return !this.isSleeping() && !this.isSitting() && !this.isFaceplanted();
    }
 
    public void playAmbientSound() {
       SoundEvent var1 = this.getAmbientSound();
@@ -585,11 +626,11 @@
    @Nullable
    protected SoundEvent getDeathSound() {
       return SoundEvents.FOX_DEATH;
    }
 
-   private boolean trusts(UUID var1) {
+   boolean trusts(UUID var1) {
       return this.getTrustedUUIDs().contains(var1);
    }
 
    protected void dropAllDeathLoot(DamageSource var1) {
       ItemStack var2 = this.getItemBySlot(EquipmentSlot.MAINHAND);
@@ -619,10 +660,14 @@
       }
 
       return true;
    }
 
+   public Vec3 getLeashOffset() {
+      return new Vec3(0.0D, (double)(0.55F * this.getEyeHeight()), (double)(this.getBbWidth() * 0.4F));
+   }
+
    static {
       DATA_TYPE_ID = SynchedEntityData.defineId(Fox.class, EntityDataSerializers.INT);
       DATA_FLAGS_ID = SynchedEntityData.defineId(Fox.class, EntityDataSerializers.BYTE);
       DATA_TRUSTED_ID_0 = SynchedEntityData.defineId(Fox.class, EntityDataSerializers.OPTIONAL_UUID);
       DATA_TRUSTED_ID_1 = SynchedEntityData.defineId(Fox.class, EntityDataSerializers.OPTIONAL_UUID);
@@ -643,61 +688,187 @@
       AVOID_PLAYERS = (var0) -> {
          return !var0.isDiscrete() && EntitySelector.NO_CREATIVE_OR_SPECTATOR.test(var0);
       };
    }
 
-   class FoxLookAtPlayerGoal extends LookAtPlayerGoal {
-      public FoxLookAtPlayerGoal(Mob var2, Class<? extends LivingEntity> var3, float var4) {
-         super(var2, var3, var4);
+   public class FoxLookControl extends LookControl {
+      public FoxLookControl() {
+         super(Fox.this);
       }
 
-      public boolean canUse() {
-         return super.canUse() && !Fox.this.isFaceplanted() && !Fox.this.isInterested();
+      public void tick() {
+         if (!Fox.this.isSleeping()) {
+            super.tick();
+         }
+
       }
 
-      public boolean canContinueToUse() {
-         return super.canContinueToUse() && !Fox.this.isFaceplanted() && !Fox.this.isInterested();
+      protected boolean resetXRotOnTick() {
+         return !Fox.this.isPouncing() && !Fox.this.isCrouching() && !Fox.this.isInterested() && !Fox.this.isFaceplanted();
       }
    }
 
-   class FoxFollowParentGoal extends FollowParentGoal {
-      private final Fox fox;
+   class FoxMoveControl extends MoveControl {
+      public FoxMoveControl() {
+         super(Fox.this);
+      }
 
-      public FoxFollowParentGoal(Fox var2, double var3) {
-         super(var2, var3);
-         this.fox = var2;
+      public void tick() {
+         if (Fox.this.canMove()) {
+            super.tick();
+         }
+
       }
+   }
 
+   private class FoxFloatGoal extends FloatGoal {
+      public FoxFloatGoal() {
+         super(Fox.this);
+      }
+
+      public void start() {
+         super.start();
+         Fox.this.clearStates();
+      }
+
       public boolean canUse() {
-         return !this.fox.isDefending() && super.canUse();
+         return Fox.this.isInWater() && Fox.this.getFluidHeight(FluidTags.WATER) > 0.25D || Fox.this.isInLava();
       }
+   }
 
+   private class FaceplantGoal extends Goal {
+      int countdown;
+
+      public FaceplantGoal() {
+         this.setFlags(EnumSet.of(Goal.Flag.LOOK, Goal.Flag.JUMP, Goal.Flag.MOVE));
+      }
+
+      public boolean canUse() {
+         return Fox.this.isFaceplanted();
+      }
+
       public boolean canContinueToUse() {
-         return !this.fox.isDefending() && super.canContinueToUse();
+         return this.canUse() && this.countdown > 0;
       }
 
       public void start() {
-         this.fox.clearStates();
+         this.countdown = 40;
+      }
+
+      public void stop() {
+         Fox.this.setFaceplanted(false);
+      }
+
+      public void tick() {
+         --this.countdown;
+      }
+   }
+
+   private class FoxPanicGoal extends PanicGoal {
+      public FoxPanicGoal(double var2) {
+         super(Fox.this, var2);
+      }
+
+      public boolean canUse() {
+         return !Fox.this.isDefending() && super.canUse();
+      }
+   }
+
+   private class FoxBreedGoal extends BreedGoal {
+      public FoxBreedGoal(double var2) {
+         super(Fox.this, var2);
+      }
+
+      public void start() {
+         ((Fox)this.animal).clearStates();
+         ((Fox)this.partner).clearStates();
          super.start();
       }
+
+      protected void breed() {
+         ServerLevel var1 = (ServerLevel)this.level;
+         Fox var2 = (Fox)this.animal.getBreedOffspring(var1, this.partner);
+         if (var2 != null) {
+            ServerPlayer var3 = this.animal.getLoveCause();
+            ServerPlayer var4 = this.partner.getLoveCause();
+            ServerPlayer var5 = var3;
+            if (var3 != null) {
+               var2.addTrustedUUID(var3.getUUID());
+            } else {
+               var5 = var4;
+            }
+
+            if (var4 != null && var3 != var4) {
+               var2.addTrustedUUID(var4.getUUID());
+            }
+
+            if (var5 != null) {
+               var5.awardStat(Stats.ANIMALS_BRED);
+               CriteriaTriggers.BRED_ANIMALS.trigger(var5, this.animal, this.partner, var2);
+            }
+
+            this.animal.setAge(6000);
+            this.partner.setAge(6000);
+            this.animal.resetLove();
+            this.partner.resetLove();
+            var2.setAge(-24000);
+            var2.moveTo(this.animal.getX(), this.animal.getY(), this.animal.getZ(), 0.0F, 0.0F);
+            var1.addFreshEntityWithPassengers(var2);
+            this.level.broadcastEntityEvent(this.animal, (byte)18);
+            if (this.level.getGameRules().getBoolean(GameRules.RULE_DOMOBLOOT)) {
+               this.level.addFreshEntity(new ExperienceOrb(this.level, this.animal.getX(), this.animal.getY(), this.animal.getZ(), this.animal.getRandom().nextInt(7) + 1));
+            }
+
+         }
+      }
    }
 
-   public class FoxLookControl extends LookControl {
-      public FoxLookControl() {
-         super(Fox.this);
+   private class StalkPreyGoal extends Goal {
+      public StalkPreyGoal() {
+         this.setFlags(EnumSet.of(Goal.Flag.MOVE, Goal.Flag.LOOK));
       }
 
-      public void tick() {
-         if (!Fox.this.isSleeping()) {
-            super.tick();
+      public boolean canUse() {
+         if (Fox.this.isSleeping()) {
+            return false;
+         } else {
+            LivingEntity var1 = Fox.this.getTarget();
+            return var1 != null && var1.isAlive() && Fox.STALKABLE_PREY.test(var1) && Fox.this.distanceToSqr(var1) > 36.0D && !Fox.this.isCrouching() && !Fox.this.isInterested() && !Fox.this.jumping;
          }
+      }
 
+      public void start() {
+         Fox.this.setSitting(false);
+         Fox.this.setFaceplanted(false);
       }
 
-      protected boolean resetXRotOnTick() {
-         return !Fox.this.isPouncing() && !Fox.this.isCrouching() && !Fox.this.isInterested() & !Fox.this.isFaceplanted();
+      public void stop() {
+         LivingEntity var1 = Fox.this.getTarget();
+         if (var1 != null && Fox.isPathClear(Fox.this, var1)) {
+            Fox.this.setIsInterested(true);
+            Fox.this.setIsCrouching(true);
+            Fox.this.getNavigation().stop();
+            Fox.this.getLookControl().setLookAt(var1, (float)Fox.this.getMaxHeadYRot(), (float)Fox.this.getMaxHeadXRot());
+         } else {
+            Fox.this.setIsInterested(false);
+            Fox.this.setIsCrouching(false);
+         }
+
       }
+
+      public void tick() {
+         LivingEntity var1 = Fox.this.getTarget();
+         Fox.this.getLookControl().setLookAt(var1, (float)Fox.this.getMaxHeadYRot(), (float)Fox.this.getMaxHeadXRot());
+         if (Fox.this.distanceToSqr(var1) <= 36.0D) {
+            Fox.this.setIsInterested(true);
+            Fox.this.setIsCrouching(true);
+            Fox.this.getNavigation().stop();
+         } else {
+            Fox.this.getNavigation().moveTo((Entity)var1, 1.5D);
+         }
+
+      }
    }
 
    public class FoxPounceGoal extends JumpGoal {
       public FoxPounceGoal() {
       }
@@ -728,11 +899,11 @@
 
       public boolean canContinueToUse() {
          LivingEntity var1 = Fox.this.getTarget();
          if (var1 != null && var1.isAlive()) {
             double var2 = Fox.this.getDeltaMovement().y;
-            return (var2 * var2 >= 0.05000000074505806D || Math.abs(Fox.this.xRot) >= 15.0F || !Fox.this.onGround) && !Fox.this.isFaceplanted();
+            return (var2 * var2 >= 0.05000000074505806D || Math.abs(Fox.this.getXRot()) >= 15.0F || !Fox.this.onGround) && !Fox.this.isFaceplanted();
          } else {
             return false;
          }
       }
 
@@ -765,116 +936,179 @@
             Fox.this.getLookControl().setLookAt(var1, 60.0F, 30.0F);
          }
 
          if (!Fox.this.isFaceplanted()) {
             Vec3 var2 = Fox.this.getDeltaMovement();
-            if (var2.y * var2.y < 0.029999999329447746D && Fox.this.xRot != 0.0F) {
-               Fox.this.xRot = Mth.rotlerp(Fox.this.xRot, 0.0F, 0.2F);
+            if (var2.y * var2.y < 0.029999999329447746D && Fox.this.getXRot() != 0.0F) {
+               Fox.this.setXRot(Mth.rotlerp(Fox.this.getXRot(), 0.0F, 0.2F));
             } else {
-               double var3 = Math.sqrt(Entity.getHorizontalDistanceSqr(var2));
+               double var3 = var2.horizontalDistance();
                double var5 = Math.signum(-var2.y) * Math.acos(var3 / var2.length()) * 57.2957763671875D;
-               Fox.this.xRot = (float)var5;
+               Fox.this.setXRot((float)var5);
             }
          }
 
          if (var1 != null && Fox.this.distanceTo(var1) <= 2.0F) {
             Fox.this.doHurtTarget(var1);
-         } else if (Fox.this.xRot > 0.0F && Fox.this.onGround && (float)Fox.this.getDeltaMovement().y != 0.0F && Fox.this.level.getBlockState(Fox.this.blockPosition()).is(Blocks.SNOW)) {
-            Fox.this.xRot = 60.0F;
+         } else if (Fox.this.getXRot() > 0.0F && Fox.this.onGround && (float)Fox.this.getDeltaMovement().y != 0.0F && Fox.this.level.getBlockState(Fox.this.blockPosition()).is(Blocks.SNOW)) {
+            Fox.this.setXRot(60.0F);
             Fox.this.setTarget((LivingEntity)null);
             Fox.this.setFaceplanted(true);
          }
 
       }
    }
 
-   class FoxFloatGoal extends FloatGoal {
-      public FoxFloatGoal() {
-         super(Fox.this);
+   class SeekShelterGoal extends FleeSunGoal {
+      private int interval = 100;
+
+      public SeekShelterGoal(double var2) {
+         super(Fox.this, var2);
       }
 
+      public boolean canUse() {
+         if (!Fox.this.isSleeping() && this.mob.getTarget() == null) {
+            if (Fox.this.level.isThundering()) {
+               return true;
+            } else if (this.interval > 0) {
+               --this.interval;
+               return false;
+            } else {
+               this.interval = 100;
+               BlockPos var1 = this.mob.blockPosition();
+               return Fox.this.level.isDay() && Fox.this.level.canSeeSky(var1) && !((ServerLevel)Fox.this.level).isVillage(var1) && this.setWantedPos();
+            }
+         } else {
+            return false;
+         }
+      }
+
       public void start() {
-         super.start();
          Fox.this.clearStates();
+         super.start();
       }
+   }
 
-      public boolean canUse() {
-         return Fox.this.isInWater() && Fox.this.getFluidHeight(FluidTags.WATER) > 0.25D || Fox.this.isInLava();
+   private class FoxMeleeAttackGoal extends MeleeAttackGoal {
+      public FoxMeleeAttackGoal(double var2, boolean var4) {
+         super(Fox.this, var2, var4);
       }
-   }
 
-   class FoxStrollThroughVillageGoal extends StrollThroughVillageGoal {
-      public FoxStrollThroughVillageGoal(int var2, int var3) {
-         super(Fox.this, var3);
+      protected void checkAndPerformAttack(LivingEntity var1, double var2) {
+         double var4 = this.getAttackReachSqr(var1);
+         if (var2 <= var4 && this.isTimeToAttack()) {
+            this.resetAttackCooldown();
+            this.mob.doHurtTarget(var1);
+            Fox.this.playSound(SoundEvents.FOX_BITE, 1.0F, 1.0F);
+         }
+
       }
 
       public void start() {
-         Fox.this.clearStates();
+         Fox.this.setIsInterested(false);
          super.start();
       }
 
       public boolean canUse() {
-         return super.canUse() && this.canFoxMove();
+         return !Fox.this.isSitting() && !Fox.this.isSleeping() && !Fox.this.isCrouching() && !Fox.this.isFaceplanted() && super.canUse();
       }
+   }
 
+   private class SleepGoal extends Fox.FoxBehaviorGoal {
+      private static final int WAIT_TIME_BEFORE_SLEEP = 140;
+      private int countdown;
+
+      public SleepGoal() {
+         super();
+         this.countdown = Fox.this.random.nextInt(140);
+         this.setFlags(EnumSet.of(Goal.Flag.MOVE, Goal.Flag.LOOK, Goal.Flag.JUMP));
+      }
+
+      public boolean canUse() {
+         if (Fox.this.xxa == 0.0F && Fox.this.yya == 0.0F && Fox.this.zza == 0.0F) {
+            return this.canSleep() || Fox.this.isSleeping();
+         } else {
+            return false;
+         }
+      }
+
       public boolean canContinueToUse() {
-         return super.canContinueToUse() && this.canFoxMove();
+         return this.canSleep();
       }
 
-      private boolean canFoxMove() {
-         return !Fox.this.isSleeping() && !Fox.this.isSitting() && !Fox.this.isDefending() && Fox.this.getTarget() == null;
+      private boolean canSleep() {
+         if (this.countdown > 0) {
+            --this.countdown;
+            return false;
+         } else {
+            return Fox.this.level.isDay() && this.hasShelter() && !this.alertable() && !Fox.this.isInPowderSnow;
+         }
       }
-   }
 
-   class FoxPanicGoal extends PanicGoal {
-      public FoxPanicGoal(double var2) {
-         super(Fox.this, var2);
+      public void stop() {
+         this.countdown = Fox.this.random.nextInt(140);
+         Fox.this.clearStates();
       }
 
-      public boolean canUse() {
-         return !Fox.this.isDefending() && super.canUse();
+      public void start() {
+         Fox.this.setSitting(false);
+         Fox.this.setIsCrouching(false);
+         Fox.this.setIsInterested(false);
+         Fox.this.setJumping(false);
+         Fox.this.setSleeping(true);
+         Fox.this.getNavigation().stop();
+         Fox.this.getMoveControl().setWantedPosition(Fox.this.getX(), Fox.this.getY(), Fox.this.getZ(), 0.0D);
       }
    }
 
-   class FaceplantGoal extends Goal {
-      int countdown;
+   class FoxFollowParentGoal extends FollowParentGoal {
+      private final Fox fox;
 
-      public FaceplantGoal() {
-         this.setFlags(EnumSet.of(Goal.Flag.LOOK, Goal.Flag.JUMP, Goal.Flag.MOVE));
+      public FoxFollowParentGoal(Fox var2, double var3) {
+         super(var2, var3);
+         this.fox = var2;
       }
 
       public boolean canUse() {
-         return Fox.this.isFaceplanted();
+         return !this.fox.isDefending() && super.canUse();
       }
 
       public boolean canContinueToUse() {
-         return this.canUse() && this.countdown > 0;
+         return !this.fox.isDefending() && super.canContinueToUse();
       }
 
       public void start() {
-         this.countdown = 40;
+         this.fox.clearStates();
+         super.start();
       }
+   }
 
-      public void stop() {
-         Fox.this.setFaceplanted(false);
+   private class FoxStrollThroughVillageGoal extends StrollThroughVillageGoal {
+      public FoxStrollThroughVillageGoal(int var2, int var3) {
+         super(Fox.this, var3);
       }
 
-      public void tick() {
-         --this.countdown;
+      public void start() {
+         Fox.this.clearStates();
+         super.start();
       }
-   }
 
-   public static class FoxGroupData extends AgableMob.AgableMobGroupData {
-      public final Fox.Type type;
+      public boolean canUse() {
+         return super.canUse() && this.canFoxMove();
+      }
 
-      public FoxGroupData(Fox.Type var1) {
-         super(false);
-         this.type = var1;
+      public boolean canContinueToUse() {
+         return super.canContinueToUse() && this.canFoxMove();
       }
+
+      private boolean canFoxMove() {
+         return !Fox.this.isSleeping() && !Fox.this.isSitting() && !Fox.this.isDefending() && Fox.this.getTarget() == null;
+      }
    }
 
    public class FoxEatBerriesGoal extends MoveToBlockGoal {
+      private static final int WAIT_TICKS = 40;
       protected int ticksWaited;
 
       public FoxEatBerriesGoal(double var2, int var4, int var5) {
          super(Fox.this, var2, var4, var5);
       }
@@ -887,11 +1121,11 @@
          return this.tryTicks % 100 == 0;
       }
 
       protected boolean isValidTarget(LevelReader var1, BlockPos var2) {
          BlockState var3 = var1.getBlockState(var2);
-         return var3.is(Blocks.SWEET_BERRY_BUSH) && (Integer)var3.getValue(SweetBerryBushBlock.AGE) >= 2;
+         return var3.is(Blocks.SWEET_BERRY_BUSH) && (Integer)var3.getValue(SweetBerryBushBlock.AGE) >= 2 || CaveVines.hasGlowBerries(var3);
       }
 
       public void tick() {
          if (this.isReachedTarget()) {
             if (this.ticksWaited >= 40) {
@@ -908,27 +1142,38 @@
 
       protected void onReachedTarget() {
          if (Fox.this.level.getGameRules().getBoolean(GameRules.RULE_MOBGRIEFING)) {
             BlockState var1 = Fox.this.level.getBlockState(this.blockPos);
             if (var1.is(Blocks.SWEET_BERRY_BUSH)) {
-               int var2 = (Integer)var1.getValue(SweetBerryBushBlock.AGE);
-               var1.setValue(SweetBerryBushBlock.AGE, 1);
-               int var3 = 1 + Fox.this.level.random.nextInt(2) + (var2 == 3 ? 1 : 0);
-               ItemStack var4 = Fox.this.getItemBySlot(EquipmentSlot.MAINHAND);
-               if (var4.isEmpty()) {
-                  Fox.this.setItemSlot(EquipmentSlot.MAINHAND, new ItemStack(Items.SWEET_BERRIES));
-                  --var3;
-               }
+               this.pickSweetBerries(var1);
+            } else if (CaveVines.hasGlowBerries(var1)) {
+               this.pickGlowBerry(var1);
+            }
 
-               if (var3 > 0) {
-                  Block.popResource(Fox.this.level, this.blockPos, new ItemStack(Items.SWEET_BERRIES, var3));
-               }
+         }
+      }
 
-               Fox.this.playSound(SoundEvents.SWEET_BERRY_BUSH_PICK_BERRIES, 1.0F, 1.0F);
-               Fox.this.level.setBlock(this.blockPos, (BlockState)var1.setValue(SweetBerryBushBlock.AGE, 1), 2);
-            }
+      private void pickGlowBerry(BlockState var1) {
+         CaveVines.use(var1, Fox.this.level, this.blockPos);
+      }
+
+      private void pickSweetBerries(BlockState var1) {
+         int var2 = (Integer)var1.getValue(SweetBerryBushBlock.AGE);
+         var1.setValue(SweetBerryBushBlock.AGE, 1);
+         int var3 = 1 + Fox.this.level.random.nextInt(2) + (var2 == 3 ? 1 : 0);
+         ItemStack var4 = Fox.this.getItemBySlot(EquipmentSlot.MAINHAND);
+         if (var4.isEmpty()) {
+            Fox.this.setItemSlot(EquipmentSlot.MAINHAND, new ItemStack(Items.SWEET_BERRIES));
+            --var3;
          }
+
+         if (var3 > 0) {
+            Block.popResource(Fox.this.level, this.blockPos, new ItemStack(Items.SWEET_BERRIES, var3));
+         }
+
+         Fox.this.playSound(SoundEvents.SWEET_BERRY_BUSH_PICK_BERRIES, 1.0F, 1.0F);
+         Fox.this.level.setBlock(this.blockPos, (BlockState)var1.setValue(SweetBerryBushBlock.AGE, 1), 2);
       }
 
       public boolean canUse() {
          return !Fox.this.isSleeping() && super.canUse();
       }
@@ -938,18 +1183,72 @@
          Fox.this.setSitting(false);
          super.start();
       }
    }
 
+   private class FoxSearchForItemsGoal extends Goal {
+      public FoxSearchForItemsGoal() {
+         this.setFlags(EnumSet.of(Goal.Flag.MOVE));
+      }
+
+      public boolean canUse() {
+         if (!Fox.this.getItemBySlot(EquipmentSlot.MAINHAND).isEmpty()) {
+            return false;
+         } else if (Fox.this.getTarget() == null && Fox.this.getLastHurtByMob() == null) {
+            if (!Fox.this.canMove()) {
+               return false;
+            } else if (Fox.this.getRandom().nextInt(10) != 0) {
+               return false;
+            } else {
+               List var1 = Fox.this.level.getEntitiesOfClass(ItemEntity.class, Fox.this.getBoundingBox().inflate(8.0D, 8.0D, 8.0D), Fox.ALLOWED_ITEMS);
+               return !var1.isEmpty() && Fox.this.getItemBySlot(EquipmentSlot.MAINHAND).isEmpty();
+            }
+         } else {
+            return false;
+         }
+      }
+
+      public void tick() {
+         List var1 = Fox.this.level.getEntitiesOfClass(ItemEntity.class, Fox.this.getBoundingBox().inflate(8.0D, 8.0D, 8.0D), Fox.ALLOWED_ITEMS);
+         ItemStack var2 = Fox.this.getItemBySlot(EquipmentSlot.MAINHAND);
+         if (var2.isEmpty() && !var1.isEmpty()) {
+            Fox.this.getNavigation().moveTo((Entity)var1.get(0), 1.2000000476837158D);
+         }
+
+      }
+
+      public void start() {
+         List var1 = Fox.this.level.getEntitiesOfClass(ItemEntity.class, Fox.this.getBoundingBox().inflate(8.0D, 8.0D, 8.0D), Fox.ALLOWED_ITEMS);
+         if (!var1.isEmpty()) {
+            Fox.this.getNavigation().moveTo((Entity)var1.get(0), 1.2000000476837158D);
+         }
+
+      }
+   }
+
+   class FoxLookAtPlayerGoal extends LookAtPlayerGoal {
+      public FoxLookAtPlayerGoal(Mob var2, Class<? extends LivingEntity> var3, float var4) {
+         super(var2, var3, var4);
+      }
+
+      public boolean canUse() {
+         return super.canUse() && !Fox.this.isFaceplanted() && !Fox.this.isInterested();
+      }
+
+      public boolean canContinueToUse() {
+         return super.canContinueToUse() && !Fox.this.isFaceplanted() && !Fox.this.isInterested();
+      }
+   }
+
    class PerchAndSearchGoal extends Fox.FoxBehaviorGoal {
       private double relX;
       private double relZ;
       private int lookTime;
       private int looksRemaining;
 
       public PerchAndSearchGoal() {
-         super(null);
+         super();
          this.setFlags(EnumSet.of(Goal.Flag.MOVE, Goal.Flag.LOOK));
       }
 
       public boolean canUse() {
          return Fox.this.getLastHurtByMob() == null && Fox.this.getRandom().nextFloat() < 0.02F && !Fox.this.isSleeping() && Fox.this.getTarget() == null && Fox.this.getNavigation().isDone() && !this.alertable() && !Fox.this.isPouncing() && !Fox.this.isCrouching();
@@ -986,133 +1285,17 @@
          this.relZ = Math.sin(var1);
          this.lookTime = 80 + Fox.this.getRandom().nextInt(20);
       }
    }
 
-   class SleepGoal extends Fox.FoxBehaviorGoal {
-      private int countdown;
-
-      public SleepGoal() {
-         super(null);
-         this.countdown = Fox.this.random.nextInt(140);
-         this.setFlags(EnumSet.of(Goal.Flag.MOVE, Goal.Flag.LOOK, Goal.Flag.JUMP));
-      }
-
-      public boolean canUse() {
-         if (Fox.this.xxa == 0.0F && Fox.this.yya == 0.0F && Fox.this.zza == 0.0F) {
-            return this.canSleep() || Fox.this.isSleeping();
-         } else {
-            return false;
-         }
-      }
-
-      public boolean canContinueToUse() {
-         return this.canSleep();
-      }
-
-      private boolean canSleep() {
-         if (this.countdown > 0) {
-            --this.countdown;
-            return false;
-         } else {
-            return Fox.this.level.isDay() && this.hasShelter() && !this.alertable();
-         }
-      }
-
-      public void stop() {
-         this.countdown = Fox.this.random.nextInt(140);
-         Fox.this.clearStates();
-      }
-
-      public void start() {
-         Fox.this.setSitting(false);
-         Fox.this.setIsCrouching(false);
-         Fox.this.setIsInterested(false);
-         Fox.this.setJumping(false);
-         Fox.this.setSleeping(true);
-         Fox.this.getNavigation().stop();
-         Fox.this.getMoveControl().setWantedPosition(Fox.this.getX(), Fox.this.getY(), Fox.this.getZ(), 0.0D);
-      }
-   }
-
-   abstract class FoxBehaviorGoal extends Goal {
-      private final TargetingConditions alertableTargeting;
-
-      private FoxBehaviorGoal() {
-         this.alertableTargeting = (new TargetingConditions()).range(12.0D).allowUnseeable().selector(Fox.this.new FoxAlertableEntitiesSelector());
-      }
-
-      protected boolean hasShelter() {
-         BlockPos var1 = new BlockPos(Fox.this.getX(), Fox.this.getBoundingBox().maxY, Fox.this.getZ());
-         return !Fox.this.level.canSeeSky(var1) && Fox.this.getWalkTargetValue(var1) >= 0.0F;
-      }
-
-      protected boolean alertable() {
-         return !Fox.this.level.getNearbyEntities(LivingEntity.class, this.alertableTargeting, Fox.this, Fox.this.getBoundingBox().inflate(12.0D, 6.0D, 12.0D)).isEmpty();
-      }
-   }
-
-   public class FoxAlertableEntitiesSelector implements Predicate<LivingEntity> {
-      public FoxAlertableEntitiesSelector() {
-      }
-
-      public boolean test(LivingEntity var1) {
-         if (var1 instanceof Fox) {
-            return false;
-         } else if (!(var1 instanceof Chicken) && !(var1 instanceof Rabbit) && !(var1 instanceof Monster)) {
-            if (var1 instanceof TamableAnimal) {
-               return !((TamableAnimal)var1).isTame();
-            } else if (var1 instanceof Player && (var1.isSpectator() || ((Player)var1).isCreative())) {
-               return false;
-            } else if (Fox.this.trusts(var1.getUUID())) {
-               return false;
-            } else {
-               return !var1.isSleeping() && !var1.isDiscrete();
-            }
-         } else {
-            return true;
-         }
-      }
-   }
-
-   class SeekShelterGoal extends FleeSunGoal {
-      private int interval = 100;
-
-      public SeekShelterGoal(double var2) {
-         super(Fox.this, var2);
-      }
-
-      public boolean canUse() {
-         if (!Fox.this.isSleeping() && this.mob.getTarget() == null) {
-            if (Fox.this.level.isThundering()) {
-               return true;
-            } else if (this.interval > 0) {
-               --this.interval;
-               return false;
-            } else {
-               this.interval = 100;
-               BlockPos var1 = this.mob.blockPosition();
-               return Fox.this.level.isDay() && Fox.this.level.canSeeSky(var1) && !((ServerLevel)Fox.this.level).isVillage(var1) && this.setWantedPos();
-            }
-         } else {
-            return false;
-         }
-      }
-
-      public void start() {
-         Fox.this.clearStates();
-         super.start();
-      }
-   }
-
    class DefendTrustedTargetGoal extends NearestAttackableTargetGoal<LivingEntity> {
       @Nullable
       private LivingEntity trustedLastHurtBy;
       private LivingEntity trustedLastHurt;
       private int timestamp;
 
-      public DefendTrustedTargetGoal(Class<LivingEntity> var2, boolean var3, boolean var4, Predicate<LivingEntity> var5) {
+      public DefendTrustedTargetGoal(Class<LivingEntity> var2, boolean var3, boolean var4, @Nullable Predicate<LivingEntity> var5) {
          super(Fox.this, var2, 10, var3, var4, var5);
       }
 
       public boolean canUse() {
          if (this.randomInterval > 0 && this.mob.getRandom().nextInt(this.randomInterval) != 0) {
@@ -1150,184 +1333,10 @@
          Fox.this.wakeUp();
          super.start();
       }
    }
 
-   class FoxBreedGoal extends BreedGoal {
-      public FoxBreedGoal(double var2) {
-         super(Fox.this, var2);
-      }
-
-      public void start() {
-         ((Fox)this.animal).clearStates();
-         ((Fox)this.partner).clearStates();
-         super.start();
-      }
-
-      protected void breed() {
-         ServerLevel var1 = (ServerLevel)this.level;
-         Fox var2 = (Fox)this.animal.getBreedOffspring(var1, this.partner);
-         if (var2 != null) {
-            ServerPlayer var3 = this.animal.getLoveCause();
-            ServerPlayer var4 = this.partner.getLoveCause();
-            ServerPlayer var5 = var3;
-            if (var3 != null) {
-               var2.addTrustedUUID(var3.getUUID());
-            } else {
-               var5 = var4;
-            }
-
-            if (var4 != null && var3 != var4) {
-               var2.addTrustedUUID(var4.getUUID());
-            }
-
-            if (var5 != null) {
-               var5.awardStat(Stats.ANIMALS_BRED);
-               CriteriaTriggers.BRED_ANIMALS.trigger(var5, this.animal, this.partner, var2);
-            }
-
-            this.animal.setAge(6000);
-            this.partner.setAge(6000);
-            this.animal.resetLove();
-            this.partner.resetLove();
-            var2.setAge(-24000);
-            var2.moveTo(this.animal.getX(), this.animal.getY(), this.animal.getZ(), 0.0F, 0.0F);
-            var1.addFreshEntityWithPassengers(var2);
-            this.level.broadcastEntityEvent(this.animal, (byte)18);
-            if (this.level.getGameRules().getBoolean(GameRules.RULE_DOMOBLOOT)) {
-               this.level.addFreshEntity(new ExperienceOrb(this.level, this.animal.getX(), this.animal.getY(), this.animal.getZ(), this.animal.getRandom().nextInt(7) + 1));
-            }
-
-         }
-      }
-   }
-
-   class FoxMeleeAttackGoal extends MeleeAttackGoal {
-      public FoxMeleeAttackGoal(double var2, boolean var4) {
-         super(Fox.this, var2, var4);
-      }
-
-      protected void checkAndPerformAttack(LivingEntity var1, double var2) {
-         double var4 = this.getAttackReachSqr(var1);
-         if (var2 <= var4 && this.isTimeToAttack()) {
-            this.resetAttackCooldown();
-            this.mob.doHurtTarget(var1);
-            Fox.this.playSound(SoundEvents.FOX_BITE, 1.0F, 1.0F);
-         }
-
-      }
-
-      public void start() {
-         Fox.this.setIsInterested(false);
-         super.start();
-      }
-
-      public boolean canUse() {
-         return !Fox.this.isSitting() && !Fox.this.isSleeping() && !Fox.this.isCrouching() && !Fox.this.isFaceplanted() && super.canUse();
-      }
-   }
-
-   class StalkPreyGoal extends Goal {
-      public StalkPreyGoal() {
-         this.setFlags(EnumSet.of(Goal.Flag.MOVE, Goal.Flag.LOOK));
-      }
-
-      public boolean canUse() {
-         if (Fox.this.isSleeping()) {
-            return false;
-         } else {
-            LivingEntity var1 = Fox.this.getTarget();
-            return var1 != null && var1.isAlive() && Fox.STALKABLE_PREY.test(var1) && Fox.this.distanceToSqr(var1) > 36.0D && !Fox.this.isCrouching() && !Fox.this.isInterested() && !Fox.this.jumping;
-         }
-      }
-
-      public void start() {
-         Fox.this.setSitting(false);
-         Fox.this.setFaceplanted(false);
-      }
-
-      public void stop() {
-         LivingEntity var1 = Fox.this.getTarget();
-         if (var1 != null && Fox.isPathClear(Fox.this, var1)) {
-            Fox.this.setIsInterested(true);
-            Fox.this.setIsCrouching(true);
-            Fox.this.getNavigation().stop();
-            Fox.this.getLookControl().setLookAt(var1, (float)Fox.this.getMaxHeadYRot(), (float)Fox.this.getMaxHeadXRot());
-         } else {
-            Fox.this.setIsInterested(false);
-            Fox.this.setIsCrouching(false);
-         }
-
-      }
-
-      public void tick() {
-         LivingEntity var1 = Fox.this.getTarget();
-         Fox.this.getLookControl().setLookAt(var1, (float)Fox.this.getMaxHeadYRot(), (float)Fox.this.getMaxHeadXRot());
-         if (Fox.this.distanceToSqr(var1) <= 36.0D) {
-            Fox.this.setIsInterested(true);
-            Fox.this.setIsCrouching(true);
-            Fox.this.getNavigation().stop();
-         } else {
-            Fox.this.getNavigation().moveTo((Entity)var1, 1.5D);
-         }
-
-      }
-   }
-
-   class FoxMoveControl extends MoveControl {
-      public FoxMoveControl() {
-         super(Fox.this);
-      }
-
-      public void tick() {
-         if (Fox.this.canMove()) {
-            super.tick();
-         }
-
-      }
-   }
-
-   class FoxSearchForItemsGoal extends Goal {
-      public FoxSearchForItemsGoal() {
-         this.setFlags(EnumSet.of(Goal.Flag.MOVE));
-      }
-
-      public boolean canUse() {
-         if (!Fox.this.getItemBySlot(EquipmentSlot.MAINHAND).isEmpty()) {
-            return false;
-         } else if (Fox.this.getTarget() == null && Fox.this.getLastHurtByMob() == null) {
-            if (!Fox.this.canMove()) {
-               return false;
-            } else if (Fox.this.getRandom().nextInt(10) != 0) {
-               return false;
-            } else {
-               List var1 = Fox.this.level.getEntitiesOfClass(ItemEntity.class, Fox.this.getBoundingBox().inflate(8.0D, 8.0D, 8.0D), Fox.ALLOWED_ITEMS);
-               return !var1.isEmpty() && Fox.this.getItemBySlot(EquipmentSlot.MAINHAND).isEmpty();
-            }
-         } else {
-            return false;
-         }
-      }
-
-      public void tick() {
-         List var1 = Fox.this.level.getEntitiesOfClass(ItemEntity.class, Fox.this.getBoundingBox().inflate(8.0D, 8.0D, 8.0D), Fox.ALLOWED_ITEMS);
-         ItemStack var2 = Fox.this.getItemBySlot(EquipmentSlot.MAINHAND);
-         if (var2.isEmpty() && !var1.isEmpty()) {
-            Fox.this.getNavigation().moveTo((Entity)var1.get(0), 1.2000000476837158D);
-         }
-
-      }
-
-      public void start() {
-         List var1 = Fox.this.level.getEntitiesOfClass(ItemEntity.class, Fox.this.getBoundingBox().inflate(8.0D, 8.0D, 8.0D), Fox.ALLOWED_ITEMS);
-         if (!var1.isEmpty()) {
-            Fox.this.getNavigation().moveTo((Entity)var1.get(0), 1.2000000476837158D);
-         }
-
-      }
-   }
-
    public static enum Type {
       RED(0, "red", new ResourceKey[]{Biomes.TAIGA, Biomes.TAIGA_HILLS, Biomes.TAIGA_MOUNTAINS, Biomes.GIANT_TREE_TAIGA, Biomes.GIANT_SPRUCE_TAIGA, Biomes.GIANT_TREE_TAIGA_HILLS, Biomes.GIANT_SPRUCE_TAIGA_HILLS}),
       SNOW(1, "snow", new ResourceKey[]{Biomes.SNOWY_TAIGA, Biomes.SNOWY_TAIGA_HILLS, Biomes.SNOWY_TAIGA_MOUNTAINS});
 
       private static final Fox.Type[] BY_ID = (Fox.Type[])Arrays.stream(values()).sorted(Comparator.comparingInt(Fox.Type::getId)).toArray((var0) -> {
@@ -1368,6 +1377,54 @@
 
       public static Fox.Type byBiome(Optional<ResourceKey<Biome>> var0) {
          return var0.isPresent() && SNOW.biomes.contains(var0.get()) ? SNOW : RED;
       }
    }
+
+   public static class FoxGroupData extends AgeableMob.AgeableMobGroupData {
+      public final Fox.Type type;
+
+      public FoxGroupData(Fox.Type var1) {
+         super(false);
+         this.type = var1;
+      }
+   }
+
+   private abstract class FoxBehaviorGoal extends Goal {
+      private final TargetingConditions alertableTargeting = TargetingConditions.forCombat().range(12.0D).ignoreLineOfSight().selector(Fox.this.new FoxAlertableEntitiesSelector());
+
+      FoxBehaviorGoal() {
+      }
+
+      protected boolean hasShelter() {
+         BlockPos var1 = new BlockPos(Fox.this.getX(), Fox.this.getBoundingBox().maxY, Fox.this.getZ());
+         return !Fox.this.level.canSeeSky(var1) && Fox.this.getWalkTargetValue(var1) >= 0.0F;
+      }
+
+      protected boolean alertable() {
+         return !Fox.this.level.getNearbyEntities(LivingEntity.class, this.alertableTargeting, Fox.this, Fox.this.getBoundingBox().inflate(12.0D, 6.0D, 12.0D)).isEmpty();
+      }
+   }
+
+   public class FoxAlertableEntitiesSelector implements Predicate<LivingEntity> {
+      public FoxAlertableEntitiesSelector() {
+      }
+
+      public boolean test(LivingEntity var1) {
+         if (var1 instanceof Fox) {
+            return false;
+         } else if (!(var1 instanceof Chicken) && !(var1 instanceof Rabbit) && !(var1 instanceof Monster)) {
+            if (var1 instanceof TamableAnimal) {
+               return !((TamableAnimal)var1).isTame();
+            } else if (var1 instanceof Player && (var1.isSpectator() || ((Player)var1).isCreative())) {
+               return false;
+            } else if (Fox.this.trusts(var1.getUUID())) {
+               return false;
+            } else {
+               return !var1.isSleeping() && !var1.isDiscrete();
+            }
+         } else {
+            return true;
+         }
+      }
+   }
 }
